<!-- Editor Interactivo de √Årboles de Decisi√≥n -->
<div class="interactive-diagram">
  <h3>Editor Interactivo de √Årboles de Decisi√≥n</h3>
  <p class="diagram-description">
    Construye tu propio √°rbol de decisi√≥n. Haz clic para seleccionar nodos, doble clic para editar nombres.
    Usa los botones de control para a√±adir, eliminar y modificar nodos.
  </p>

  <!-- Panel de Control -->
  <div class="control-panel">
    <div class="control-section">
      <h4>Controles del Nodo</h4>
      <div class="button-group">
        <button 
          class="control-btn add-btn" 
          (click)="addChildNode()"
          [disabled]="!selectedNode">
          ‚ûï A√±adir Hijo
        </button>
        
        <button 
          class="control-btn delete-btn" 
          (click)="deleteNode()"
          [disabled]="!selectedNode || selectedNode.id === '1'">
          üóëÔ∏è Eliminar
        </button>
        
        <button 
          class="control-btn decision-btn" 
          (click)="changeNodeType('decision')"
          [disabled]="!selectedNode || selectedNode.type === 'root'">
          üîÄ Decisi√≥n
        </button>
        
        <button 
          class="control-btn leaf-btn" 
          (click)="changeNodeType('leaf')"
          [disabled]="!selectedNode || selectedNode.type === 'root'">
          üçÉ Hoja
        </button>
      </div>
    </div>

    <div class="control-section">
      <h4>Acciones del √Årbol</h4>
      <div class="button-group">
        <button class="control-btn example-btn" (click)="loadExampleTree()">
          üìã Cargar Ejemplo
        </button>
        
        <button class="control-btn reset-btn" (click)="resetTree()">
          üîÑ Reiniciar
        </button>
        
        <button class="control-btn export-btn" (click)="exportTree()">
          üíæ Exportar JSON
        </button>
      </div>
    </div>
  </div>

  <!-- Editor de Texto -->
  <div class="text-editor" *ngIf="isEditing">
    <div class="editor-content">
      <h4>Editar Nodo: {{ selectedNode?.name }}</h4>
      <div class="input-group">
        <input 
          type="text" 
          [(ngModel)]="editingText" 
          placeholder="Nombre del nodo..."
          class="node-input"
          (keyup.enter)="finishEditing()"
          (keyup.escape)="cancelEditing()">
      </div>
      <div class="editor-buttons">
        <button class="save-btn" (click)="finishEditing()">‚úÖ Guardar</button>
        <button class="cancel-btn" (click)="cancelEditing()">‚ùå Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Informaci√≥n del Nodo Seleccionado -->
  <div class="node-info" *ngIf="selectedNode && !isEditing">
    <div class="info-content">
      <h4>Nodo Seleccionado</h4>
      <div class="info-details">
        <p><strong>ID:</strong> {{ selectedNode.id }}</p>
        <p><strong>Nombre:</strong> {{ selectedNode.name }}</p>
        <p><strong>Tipo:</strong> 
          <span [class]="'type-badge ' + selectedNode.type">
            {{ selectedNode.type === 'root' ? 'Ra√≠z' : 
               selectedNode.type === 'decision' ? 'Decisi√≥n' : 'Hoja' }}
          </span>
        </p>
        <p><strong>Hijos:</strong> {{ selectedNode.children?.length || 0 }}</p>
      </div>
      <button class="edit-name-btn" (click)="startEditing(selectedNode)">
        ‚úèÔ∏è Editar Nombre
      </button>
    </div>
  </div>

  <!-- Contenedor del √Årbol -->
  <div class="tree-container">
    <div #treeContainer class="d3-tree"></div>
  </div>
  
  <!-- Leyenda -->
  <div class="tree-legend">
    <div class="legend-item">
      <span class="legend-node root"></span>
      <span>Nodo Ra√≠z</span>
    </div>
    <div class="legend-item">
      <span class="legend-node decision"></span>
      <span>Nodo de Decisi√≥n</span>
    </div>
    <div class="legend-item">
      <span class="legend-node leaf"></span>
      <span>Nodo Hoja</span>
    </div>
    <div class="legend-item">
      <span class="legend-node selected"></span>
      <span>Nodo Seleccionado</span>
    </div>
  </div>

  <!-- Instrucciones -->
  <div class="instructions">
    <h4>Instrucciones de Uso:</h4>
    <ul>
      <li><strong>Seleccionar:</strong> Haz clic en un nodo para seleccionarlo</li>
      <li><strong>Editar:</strong> Doble clic en un nodo para editar su nombre</li>
      <li><strong>A√±adir:</strong> Selecciona un nodo y usa el bot√≥n "A√±adir Hijo"</li>
      <li><strong>Eliminar:</strong> Selecciona un nodo (excepto la ra√≠z) y usa "Eliminar"</li>
      <li><strong>Tipo:</strong> Cambia entre nodos de decisi√≥n y hojas seg√∫n necesites</li>
    </ul>
  </div>
</div>
